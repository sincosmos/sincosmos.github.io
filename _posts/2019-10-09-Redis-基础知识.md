---
layout:     post
title:      Redis 基础知识汇总
subtitle:   学习笔记
date:       2019-10-09
author:     sincosmos
header-img: img/post-bg-map.jpg
catalog: true
tags:
    - Redis
---

## 基本数据结构
参考资料 [Redis 数据结构基础教程](https://juejin.im/post/5b53ee7e5188251aaa2d2e16)
1) string 是一个可变的字节数组，常见的操作有 set, get, strlen, getrange, setrange, append, ttl, expire, del. 如果存入的是整数，还可以作为计数器使用，incrby, decrby, incr, decr. 使用 setbit, getbit, bitcount, bitop (bitop and/or/xor destkey key [key...]) 命令可以将 string 类型作为 bit map 使用。
2) redis 使用双向链表结构保存列表，是以列表结构为 list。因为是双链表，list 即可作为队列(lpush/rpop, rpush/lpop)使用，也可以作为堆栈(rpush/rpop, lpush/lpop)使用。用 list 可以实现 redis 消息队列（ redis 另外提供了发布/订阅机制实现消息队列)。list 的 push 支持一次操作多个元素（实际 push 是依次一个一个进行的），pop 操作一次只能弹出一个元素。list 常见的其它操作有 llen (list length), lindex (get element by index), lrange (get elements by range of indices), lset (set element by index), linsert before/after (insert element before/after sepcified element), lrem count (if count > 0, search from head, remove count of elements; if count < 0, search from tail, remove count of elements; if count = 0, remove all elements), ltrim (维护定长列表，除了范围内的元素外，其它元素将被删除)
3) hash 等价于 java 中的 HashMap，存储的是键值对。使用 hset (hset v_name key1 value 一次加入一个键值对)或 hmset（hmset v_name key2 value2 key3 value3... 一次加入多个键值对）。hdel 支持一次删除一个或多个键。hget 获得键对应的值，hexists 判断键是否存在于 hash 中。如果键对应的值是整数，我们也可以将整数作为计数器使用，相关的命令有 hincrby, hdecrby。hgetall 得到 hash 中所有的键值对。
4) 类似 java, redis set 的内部实现也是基于上面的 hash，所有的键指向同一个内部值。常见的命令有 sadd (增加一个或多个元素)，members (获得所有元素)，scard (获得元素个数)，srandmember v_name [count]（随机获取 count 个元素，如果省略 count，随机取一个元素），srem v_name key1 key2 (删除一个或多个元素)，spop（随机删除一个元素），sismember （判断元素是否在 set 中）
5) zset 是 redis 提供的有序集合，可以将其理解为 map<key, score>，除了 hash 结构，为了提高增删查改的效率，底层还使用了 skiplist 结构，skiplist 按照 score 进行排序，score 可以是整数或浮点数。常用的命令有 zadd v_name score key (增加一个或多个元素)，zcard (获取元素个数)，zrem (删除一个或者多个元素)，zincrby v_name 1.2 key1 (作为计数器使用)，zscore (获取对应 key 的权重)，zrank (获得元素的正向排名)，zrevrank（获得元素的倒数排名），zrange v_name start end [withscores]（获得正向排名从 start 到 end 的所有元素，可选是否同时获得元素对应的 scores），zrevrange 和 zrange 类似，只不过它按负向排名输出元素。zrangebyscore v_name score_start score_ed [withscores] 和 zrevrangebyscore 获取指定 score 范围内的元素。zremrangebyrank 和 zremrangebyscore 分别删除指定排名范围内和权重范围内的元素。
## 发布/订阅模式
1) subscribe channel [channel ...]，订阅给定的频道列表
2) publish channel message ，将消息发送到指定的频道
3) unsubscribe channel [channel ...]，退订给定的频道列表
4) psubscribe pattern [pattern ...]，订阅符合给定模式的频道列表
5) punsubscribe pattern [pattern ...]，退订符合给定模式的频道列表
6) pubsub <subcommand> [argument [argument ...]] 查看订阅与发布系统状态，它由数个不同格式的子命令组成。
## 分布式锁
1) setex key timeout(s) value，设置 key 并并设置过期时间，整个过程是原子操作
2) setnx key value, 当指定的 key 不存在时，为 key 设置指定的值
3）getset key value, 将 value 赋值给 key，并返回旧值，如果旧值不存在返回 nil，如果旧值不是字符串类型，返回错误

## 使用 docker 部署 redis 服务
可以使用 docker 在主机上启动 redis 服务。
```
docker run -p 6379:6379 --mount source=/data,taregt=/data -d redis --appendonly yes
```
上述命令会自动拉取 redis 最新 docker 镜像并在本机启动 redis 服务，并将容器的 6379 端口与主机 6379 端口映射，其它应用可以无感知的在本机使用 redis 服务。容器启动后，可以通过如下命令启动 redis 客户端。
```
docker exec -it container-id redis-cli
```